---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.4.1
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python nbsphinx=hidden}
import pandas as pd
pd.set_option("display.max_rows", 5)
```

# Unnesting board game tags

```{python}
import pandas as pd

from siuba import _, select, mutate, filter, group_by, count, spread, gather, unnest
from plotnine import *


games = pd.read_csv(
    "https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-03-12/board_games.csv"
)
```

```{python}
small_games = select(
    games, _.name, _.description, _.category, _.mechanic, _.startswith("max")
)
```

## Splitting category tags

```{python}
small_games.category[0].split(',')
```

```{python}
small_games >> filter(_.category.isna())
```

```{python}

(small_games
  >> mutate(cat_tags=_.category.str.split(","))
  >> filter(_.cat_tags.notna())
  >> unnest("cat_tags")
)
```

### Tidying several columns with tags

```{python}
(
    small_games
    >> gather("measure", "value", _.category, _.mechanic)
    >> mutate(tags = _.value.str.split(','))
    >> unnest("tags")
)
```
